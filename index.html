<html>
  <head>
    <title>Hi! I'm a dumb page</title>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/web-socket-js/1.0.0/web_socket.min.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

    <script type="text/javascript">

      function grow($el) {
        $el.animate({
          width: 500,
          height: 500,
        },
        2000,
        'swing',
        function() {
          shrink($el,function() { grow($el); });
        });
      }

      function shrink($el, callback) {
        $el.animate({
          width: 400,
          height: 400,
          },
          1000,
          'swing',
          callback);
      }

      function doSpecialThing(image_url) {
        var $el = $('<img />');
        $el.attr('src', image_url);
        $el.css({
          position: 'fixed',
          top: '50%',
          left: '50%',
          transform: 'translate(-50%, -50%)',
          width: 100,
          height: 100
        });

        $el.appendTo('body');

        grow($el);
      };

      // Let the library know where WebSocketMain.swf is:
      WEB_SOCKET_SWF_LOCATION = "WebSocketMain.swf";

      var i = 0;
      var ws = new WebSocket("ws://localhost:8080/");
      ws.onopen = function() {
        $('.status').hide();
        $('#green-status').show();
      };
      ws.onmessage = function(e) {
        // Receives a message.
        var $element = $("<li />");
        var data = JSON.parse(e.data);
        var text;

        if(data.hasOwnProperty('image')) {
          text = data.text;

          if(text.match(/tdc/i) && text.match(/sumone/i) && i == 0) {
            doSpecialThing(data.image);
            i = 1;
          }
        } else {
          text = data;
        }

        $element.text(text);

        $('#messages-list').prepend($element);
      };
      ws.onclose = function() {
        $('.status').hide();
        $('#red-status').show();
      };
    </script>
  </head>
  <body style="margin:0;padding:0 10px;">

    <div style="width:100%;height:10px;background-color:green;"
         id="green-status" class="status"></div>

    <div style="width:100%;height:10px;background-color:red;"
         id="red-status" class="status"></div>

    <h1>Tuiterator Tabajara</h1>

    <ul id="messages-list">
    </ul>

  </body>
</html>
